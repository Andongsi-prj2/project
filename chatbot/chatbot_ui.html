<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Gemini ì±—ë´‡ ìœ„ì ¯</title>
  <style>
    /* ë„ìš°ë¯¸ ì–¼êµ´ ì•„ì´ì½˜ ë²„íŠ¼ */
    #chatbot-icon {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: transparent;
      color: #333;
      border: none;
      border-radius: 0;
      width: 120px;
      height: 120px;
      font-size: 24px;
      cursor: pointer;
      z-index: 999;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #chatbot-icon:hover {
      transform: scale(1.1);
    }
    
    /* ë§í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ - ì…ë§Œ ì›€ì§ì„ */
    .speaking {
      animation: speak 0.3s infinite alternate;
    }
    
    @keyframes speak {
      0% { 
        content: "ğŸ˜€";
      }
      50% {
        content: "ğŸ˜®";
      }
      100% { 
        content: "ğŸ˜€";
      }
    }
    
    /* íŒŒì´í”„ ì–¼êµ´ ì´ë¯¸ì§€ */
    #chatbot-icon img {
      width: 120px;
      height: 120px;
      border-radius: 0;
      display: block;
      object-fit: contain;
      background: transparent;
      filter: brightness(1.1) contrast(1.2);
      mix-blend-mode: multiply;
    }

    /* ì±—ë´‡ ì°½ */
    #chatbot-window {
      display: none;
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 300px;
      height: 400px;
      background-color: white;
      border: 1px solid #ccc;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      border-radius: 10px;
      z-index: 999;
      overflow: hidden;
      flex-direction: column;
    }

    #chat-box {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
    }

    #chat-input {
      display: flex;
      padding: 10px;
      border-top: 1px solid #ccc;
    }

    #chat-input input {
      flex: 1;
      padding: 5px;
      font-size: 14px;
    }

    #chat-input button {
      margin-left: 5px;
    }
  </style>
</head>
<body>

<!-- ë„ìš°ë¯¸ ì–¼êµ´ ì•„ì´ì½˜ -->
<button id="chatbot-icon">
  <img src="image.png" alt="íŒŒì´í”„ ë„ìš°ë¯¸" id="chatbot-image">
</button>

<!-- ì±—ë´‡ ì°½ -->
<div id="chatbot-window">
  <div id="chat-box"></div>
  <div id="chat-input">
    <input type="text" id="user-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”">
    <button onclick="sendMessage()">ì „ì†¡</button>
  </div>
</div>

<script>
  // API í‚¤ë“¤ (ì˜ˆë¹„ìš© í¬í•¨)
  const API_KEYS = [
    "AIzaSyBs8v-oDxyJZ-d3WPn9jUFBz5RR7r2AQwE",  // ì²« ë²ˆì§¸ API í‚¤
    "AIzaSyDfmxMXRNlCJ38YsakRNjEM5KcrJt3CDIQ"   // ë‘ ë²ˆì§¸ API í‚¤ (ì˜ˆë¹„)
  ];
  let currentApiKeyIndex = 0;  // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ API í‚¤ ì¸ë±ìŠ¤

  // í˜„ì¬ ì‹œê°„ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
  function getCurrentTime() {
    const now = new Date();
    const hours = now.getHours();
    const minutes = now.getMinutes();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    const displayHours = hours % 12 || 12;
    const displayMinutes = minutes.toString().padStart(2, '0');
    return `${displayHours}:${displayMinutes} ${ampm}`;
  }

  // ì•„ì´ì½˜ í´ë¦­ ì‹œ ì±—ë´‡ ì°½ í† ê¸€
  document.getElementById("chatbot-icon").addEventListener("click", () => {
    const chatbotWindow = document.getElementById("chatbot-window");
    const userInput = document.getElementById("user-input");
    const chatBox = document.getElementById("chat-box");
    
    chatbotWindow.style.display = chatbotWindow.style.display === "none" ? "flex" : "none";
    
    // ì±—ë´‡ ì°½ì´ ì—´ë¦¬ë©´ í™˜ì˜ ë©”ì‹œì§€ í‘œì‹œ
    if (chatbotWindow.style.display === "flex") {
      // ì±„íŒ…ì°½ì´ ë¹„ì–´ìˆì„ ë•Œë§Œ í™˜ì˜ ë©”ì‹œì§€ í‘œì‹œ
      if (chatBox.innerHTML === "") {
        const currentTime = getCurrentTime();
        chatBox.innerHTML += `<div style="text-align: center; color: #666; font-size: 12px; margin: 10px 0;">ì˜¤ëŠ˜ ${currentTime}</div>`;
        chatBox.innerHTML += `<div><b><img src="image.png" style="width: 20px; height: 20px; border-radius: 50%; vertical-align: middle; margin-right: 5px;"> Chatbot:</b> ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>`;
      }
      
      setTimeout(() => {
        userInput.focus();
      }, 100);
    }
  });

    // ì—”í„°í‚¤ ì…ë ¥ ê¸°ëŠ¥
  document.getElementById("user-input").addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
      sendMessage();
    }
  });

  // API í˜¸ì¶œ í•¨ìˆ˜ (ìë™ API í‚¤ ì „í™˜)
  async function callGeminiAPI(message) {
    for (let i = 0; i < API_KEYS.length; i++) {
      try {
        const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + API_KEYS[i], {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            contents: [{ parts: [{ text: message }] }]
          })
        });

        const data = await response.json();
        
        // API í‚¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì‘ë™í•˜ë©´ í˜„ì¬ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
        if (data.candidates && data.candidates[0] && data.candidates[0].content) {
          currentApiKeyIndex = i;
          return data.candidates[0].content.parts[0].text;
        }
        
        // ì‘ë‹µì´ ìˆì§€ë§Œ ì—ëŸ¬ì¸ ê²½ìš°
        if (data.error) {
          console.log(`API í‚¤ ${i + 1} ì˜¤ë¥˜:`, data.error.message);
          continue; // ë‹¤ìŒ API í‚¤ ì‹œë„
        }
        
      } catch (error) {
        console.log(`API í‚¤ ${i + 1} ì—°ê²° ì‹¤íŒ¨:`, error.message);
        continue; // ë‹¤ìŒ API í‚¤ ì‹œë„
      }
    }
    
    // ëª¨ë“  API í‚¤ê°€ ì‹¤íŒ¨í•œ ê²½ìš°
    return "âŒ ëª¨ë“  API í‚¤ê°€ ì‚¬ìš© ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
  }

  async function sendMessage() {
    const input = document.getElementById("user-input");
    const message = input.value.trim();
    if (!message) return;

    const chatBox = document.getElementById("chat-box");
    const chatbotIcon = document.getElementById("chatbot-icon");
    
    const currentTime = getCurrentTime();
    chatBox.innerHTML += `<div style="text-align: right;"><div style="display: inline-block; background-color: #e3f2fd; padding: 8px 12px; border-radius: 15px; max-width: 70%;"><b>ë‚˜:</b> ${message}</div><div style="text-align: right; color: #666; font-size: 10px; margin-top: 2px;">${currentTime}</div></div>`;
    input.value = "";

    // ë„ìš°ë¯¸ê°€ ë§í•˜ê¸° ì‹œì‘í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜
    chatbotIcon.classList.add("speaking");
    
    // ì• ë‹ˆë©”ì´ì…˜ ì œê±° - ê¹œë¹¡ì„ ë°©ì§€

    // API í˜¸ì¶œ (ìë™ ì „í™˜ í¬í•¨)
    const reply = await callGeminiAPI(message);
    const replyTime = getCurrentTime();
    chatBox.innerHTML += `<div style="text-align: left;"><div style="display: inline-block; background-color: #f5f5f5; padding: 8px 12px; border-radius: 15px; max-width: 70%;"><b><img src="image.png" style="width: 20px; height: 20px; border-radius: 50%; vertical-align: middle; margin-right: 5px;"> Chatbot:</b> ${reply}</div><div style="text-align: left; color: #666; font-size: 10px; margin-top: 2px;">${replyTime}</div></div>`;
    chatBox.scrollTop = chatBox.scrollHeight;
    
    // ë§í•˜ê¸° ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ
    chatbotIcon.classList.remove("speaking");
  }
</script>
</body>
</html>
